# 项目版本升级说明

## 升级日期
2026年1月25日

## 升级内容

### 1. JDK 版本升级
- **从**: Java 8/17 (混合配置)
- **升级到**: Java 21
- **配置位置**:
  - 根 `pom.xml`: `<java.version>21</java.version>`
  - Maven Compiler Plugin: `<source>21</source>` 和 `<target>21</target>`

### 2. Spring Boot 版本升级
- **从**: 3.1.0
- **升级到**: 3.4.1 (2024年11月发布的最新版本)
- **配置位置**:
  - 根 `pom.xml` 的 parent 依赖
  - 所有模块自动继承该版本

### 3. Spring Cloud 版本升级
- **从**: 未明确指定
- **升级到**: 2024.0.0 (代号 Moorgate，2024年底发布的最新版本)
- **配置位置**:
  - `spring-cloud/pom.xml`: `<spring-cloud.version>2024.0.0</spring-cloud.version>`

### 4. Dubbo 版本升级
- **从**: 3.0.0
- **升级到**: 3.3.0 (最新稳定版本)
- **相关依赖同步升级**:
  - Zookeeper: 3.4.10 → 3.8.4
  - Curator: 4.2.0/2.13.0 → 5.6.0 (统一版本)

### 5. 其他重要更新
- **Maven Compiler Plugin**: 3.8.1 → 3.12.1
- **Javax Annotation API**: 迁移到 Jakarta Annotation API 2.1.1 (Spring Boot 3.x 使用 Jakarta EE 9+)

## 版本兼容性说明

### Spring Boot 3.4.x 要求
- **最低 JDK 版本**: 17
- **推荐 JDK 版本**: 21 (获得最佳性能和特性支持)
- **Servlet 容器**: 支持 Jakarta Servlet 5.0+

### Spring Cloud 2024.0.0 兼容性
- **兼容 Spring Boot**: 3.4.x
- **主要组件**:
  - Spring Cloud Commons 4.2.0
  - Spring Cloud Netflix 4.2.0
  - Spring Cloud Gateway 4.2.0
  - Spring Cloud OpenFeign 4.2.0

### Dubbo 3.3.0 新特性
- **Triple X 协议**: 全面支持 HTTP/1、HTTP/2 和 HTTP/3
- **性能优化**: 弱网环境下效率提升 6 倍
- **云原生增强**: 更好的 Kubernetes 和 Service Mesh 支持

## 迁移注意事项

### 1. Jakarta EE 迁移
Spring Boot 3.x 从 Java EE 迁移到 Jakarta EE，需要注意以下包名变更：
- `javax.annotation.*` → `jakarta.annotation.*`
- `javax.servlet.*` → `jakarta.servlet.*`
- `javax.persistence.*` → `jakarta.persistence.*`

### 2. 依赖管理优化
- 移除了 dubbo/pom.xml 中重复的 dubbo 依赖声明
- 移除了 provider/pom.xml 中重复的 dubbo-spring-boot-starter 依赖声明
- 统一了 Curator 版本管理

### 3. 配置检查建议
升级后建议检查以下内容：
- [ ] 所有模块的 Java 版本一致性
- [ ] Spring Cloud Alibaba 版本兼容性（如需使用）
- [ ] 自定义配置类的兼容性
- [ ] 第三方库的 Jakarta EE 兼容性

## 验证结果

✅ Maven 构建验证通过：`mvn validate`
✅ 无依赖冲突警告
✅ 所有模块配置正确

## 回滚方案

如有需要，可以通过 Git 回滚本次更改：
```bash
git revert <commit-hash>
```

## 后续建议

1. **测试验证**: 进行全面功能测试，特别是 Dubbo 服务和 Spring Cloud 组件
2. **性能测试**: 验证新版本性能表现
3. **依赖更新**: 考虑更新其他第三方库到最新稳定版本
4. **代码优化**: 利用 Java 21 新特性（虚拟线程、模式匹配等）优化代码
5. **文档更新**: 更新项目文档中的版本说明

## 参考链接

- [Spring Boot 3.4 发布说明](https://spring.io/blog/2024/11/21/spring-boot-3-4-0-available-now)
- [Spring Cloud 2024.0 发布说明](https://spring.io/blog/2024/12/19/spring-cloud-2024-0-0-available-now)
- [Dubbo 3.3.0 发布说明](https://github.com/apache/dubbo/releases/tag/dubbo-3.3.0)
- [Spring Boot 3.x 迁移指南](https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Migration-Guide)
